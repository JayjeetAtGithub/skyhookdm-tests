steps:
# here we need to add steps to spawn machines

- id: spawn kubernetes cluster
  uses: docker://popperized/ansible:v2.9
  runs: ['./scripts/setup_kubespray.sh']
  secrets: [
    'ANSIBLE_USER',
    'ANSIBLE_SSH_KEY_DATA',
    'ANSIBLE_HOSTS'
  ]

- id: copy kube config
  uses: docker://lgatica/openssh-client
  runs: ['./scripts/copy_config.sh']
  secrets: [
    'K8S_MASTER',
    'ANSIBLE_USER',
    'ANSIBLE_SSH_KEY_DATA'
  ]

- id: setup rook skyhookdm cluster
  uses: docker://bitnami/kubectl
  runs: ['./scripts/setup_rook.sh']

- id: setup prometheus monitoring
  uses: docker://bitnami/kubectl
  runs: ['./scripts/setup_prometheus.sh']

- id: teardown prometheus monitoring
  uses: docker://bitnami/kubectl
  runs: ['./scripts/teardown_prometheus.sh']
